extends ./layout_medic

block content
  .container.mt-4
    h1.mb-4.text-primary Consulta médica

    p.mb-2
      | Médico: 
      strong #{medic.User.fullname}

    p.mb-3
      a.btn.btn-secondary.me-2(href="/medic") Volver a listado de citas

    hr

    h2.mb-3 Datos de la cita

    p.mb-1
      strong Paciente: 
      | #{patient.User.fullname}
    p.mb-1
      strong CI: 
      | #{patient.User.username}
    p.mb-1
      strong Centro de salud: 
      | #{medic.HealthCenter.name}
    p.mb-1
      strong Especialidad: 
      | #{medic.Specialty.name}
    p.mb-1
      strong Fecha: 
      | #{slot.date}
    p.mb-3
      strong Hora: 
      | #{slot.time}

    hr

    h2.mb-3 Historial del paciente

    if consultasPrevias.length === 0 && recetasPrevias.length === 0
      .alert.alert-info No hay consultas ni recetas anteriores registradas para este paciente.
    else
      if consultasPrevias.length > 0
        h3.mb-2 Consultas anteriores
        ul.list-group.mb-3
          each c in consultasPrevias
            li.list-group-item
              strong= c.createdAt.toLocaleDateString('es-BO')
              |  – Dr(a). #{c.Medic.User.fullname} – Diagnóstico: #{c.diagnosis || 'N/D'}
              if c.reason
                br
                | Motivo: #{c.reason}

      if recetasPrevias.length > 0
        h3.mb-2 Recetas anteriores
        ul.list-group.mb-3
          each r in recetasPrevias
            li.list-group-item
              strong= r.createdAt.toLocaleDateString('es-BO')
              |  – Dr(a). #{r.Medic.User.fullname}
              br
              | #{r.content}

    hr

    h2.mb-3 Registro de consulta

    form(action=`/medic/consulta/${slot.id}` method="post")
      .mb-3
        label.form-label Motivo de consulta:
        textarea.form-control(name="reason" placeholder="Ej: Dolor de cabeza, malestar general...") #{appointment.reason}

      .mb-3
        label.form-label Síntomas / Antecedentes:
        textarea.form-control(name="symptoms" placeholder="Describa brevemente los síntomas...")

      .mb-3
        label.form-label Diagnóstico:
        textarea.form-control(name="diagnosis" placeholder="Diagnóstico médico (se guarda en Consultation.diagnosis)")

      .mb-3
        label.form-label Notas / Indicaciones:
        textarea.form-control(name="notes" placeholder="Notas adicionales, recomendaciones, observaciones")

      button.btn.btn-primary(type="submit") Guardar consulta