extends ./layout_medic

block content
  h1 Consulta m√©dica

  p
    | M√©dico:
    strong #{medic.User.fullname}
    |  (ejemplo)

  p
    a(href="/medic") Volver a listado de citas
    |  | 
    a(href="/logout") Cerrar sesi√≥n

  hr

  h2 Datos de la cita

  p
    strong Paciente:
    |  #{patient.User.fullname}

  p
    strong CI:
    |  #{patient.User.username}

  p
    strong Centro de salud:
    |  #{medic.HealthCenter.name}

  p
    strong Especialidad:
    |  #{medic.Specialty.name}

  p
    strong Fecha:
    |  #{slot.date}

  p
    strong Hora:
    |  #{slot.time}

  hr

  // üî• HISTORIAL DEL PACIENTE
  h2 Historial del paciente

  if consultasPrevias.length === 0 && recetasPrevias.length === 0
    p No hay consultas ni recetas anteriores registradas para este paciente.
  else
    if consultasPrevias.length > 0
      h3 Consultas anteriores
      ul
        each c in consultasPrevias
          li
            strong= c.createdAt.toLocaleDateString('es-BO')
            |  ‚Äì Dr(a). #{c.Medic.User.fullname} ‚Äì Diagn√≥stico: #{c.diagnosis || 'N/D'}
            if c.reason
              br
              | Motivo: #{c.reason}

    if recetasPrevias.length > 0
      h3 Recetas anteriores
      ul
        each r in recetasPrevias
          li
            strong= r.createdAt.toLocaleDateString('es-BO')
            |  ‚Äì Dr(a). #{r.Medic.User.fullname}
            br
            | #{r.content}

  hr

  h2 Registro de consulta

  form(action=`/medic/consulta/${slot.id}` method="post")

    // MOTIVO
    div
      label Motivo de consulta:
      textarea(
        name="reason"
        placeholder="Ej: Dolor de cabeza, malestar general..."
      ) #{appointment.reason}

    // S√çNTOMAS
    div
      label S√≠ntomas / Antecedentes:
      textarea(
        name="symptoms"
        placeholder="Describa brevemente los s√≠ntomas..."
      )

    // DIAGN√ìSTICO
    div
      label Diagn√≥stico:
      textarea(
        name="diagnosis"
        placeholder="Diagn√≥stico m√©dico (se guarda en Consultation.diagnosis)"
      )

    // NOTAS
    div
      label Notas / Indicaciones:
      textarea(
        name="notes"
        placeholder="Notas adicionales, recomendaciones, observaciones"
      )

    button(type="submit") Guardar consulta
